# v.1.0 11.05.2018 # CLEAN MEMORY ###################################################
Invoke-Command {
$console = $host.UI.RawUI
$console.ForegroundColor = "DarkGray"
$console.BackgroundColor = "Cyan"
function Delete-Shadows {
        Write-Host Deleting shadow copies...
        Get-WmiObject Win32_Shadowcopy -ErrorAction SilentlyContinue | % { try {$_.Delete();Write-Host Shadow deleted! -f Yellow}catch{Write-Host Failed to delete! -f Yellow} } 
        vssadmin delete shadows /all
}
function Clear-Logs {
    Write-Host ...cleaning Event Logs: Job started`n
    Start-Job -Name PurgingLogs -ScriptBlock {
        Get-EventLog -LogName * | ForEach { Clear-EventLog $_.Log }
    }
    Write-Host Cleaning.. -NoNewline
    Do {
       Write-Host "." -NoNewline
       Start-Sleep -Seconds 1
    } While ( Get-Job | Where-Object {$_.State -eq "Running"})
    Write-Host `nJobs completed!
}
cls
$Services = 
"3CX
ADWS
AGMService
AGSService
AMPPALR3
AMS
ARSM
ASM
AcrSch2Svc
AcronisActiveProtectionService
AcronisAgent
AcronisMonitoringService
AcronisZmqGw
AdobeARMservice
AdobeActiveFileMonitor10.0
AdobeFlashPlayerUpdateSvc
AdobeUpdateService
AnyDesk
Apache
Apple Bonjour Service
Apple Mobile Device
Apple Mobile Device Service
BASupportExpressSrvcUpdater_LOGICnow
BASupportExpressSrvcUpdater_N_Central
BASupportExpressStandaloneService_LOGICnow
BASupportExpressStandaloneService_N_Central
BTHSSecurityMgr
Backupper Service
BayanService
CIMnotify
CcmExec
Check_MK_Agent
Cissesrv
ClickToRunSvc
CodeMeter.exe
CpqNicMgmt
CpqRcmc3
CqMgHost
CqMgServ
CqMgStor
DESIGO INSIGHT Trace Service
DPMClientService
DPMRA
DpmCPWrapperService
DriveLock
FileOpenManagerSvc
FlowExport
FontCache
HPSIService
HPWMISTOR
HealthService
IAStorDataMgrSvc
IBM Domino
LicSvrM
MMAExtensionHeartbeatService
MMS
MSCRMAsyncService
MSCRMAsyncService`$maintenance
MSCRMMonitoringService
MSCRMSandboxService
MSCRMUnzipService
MSDTC
MSExchange
MSOLAP`$SQL
MSSQL
Microsoft.Crm.VssWriterService.exe
MsDts
MsDtsServer100
MySQL
NGCLIENT
NVWMI
NetPipeActivator
NetTcpActivator
NetTcpPortSharing
OpenVPNAccessClient
OracleMTSRecoveryService
OracleOraDb11g_home1ClrAgent
OracleOraDb11g_home1TNSListener
OracleServiceINFAORCL
PolicyAgent
ProLiantMonitor
QB
QBCFMonitorService
QBFCService
QuickBooksDB
msftesql
QuickBooksDB20
RdAgent
Realtek11nCU
ReportServer
ReportServer`$ISARS
ReportServer`$SQL
RtkAudioService
SBOCli","Rbkernel","RbApplic","RbSch
SDRSVC
SNMPTRAP
SPAdmin
SPTrace
SQL
SentinelKeysServer
SentinelProtectionServer
SentinelSecurityRuntime
ShadowProtectSvc
ShutdownMon
SoftwareProxyJavaChecker
Spooler
SysMgmtHp
TdmService
TeamViewer
Tomcat
UNS
VGAuthService
VMAuthdService
VMTools
VMUSBArbService
VMnetDHCP
VMware
VSS
Veeam
VisualSVN
VisualSVNServer
WSearch
WinDefend
WindowsAzure
Wsearch
aspnet_state
bkserv
btwdins
cpqvcagent
cramsrv
crserv
crsyslog
db
dbex
discagt
disvc
dlhm
dwmrcs
fvstermiser
hMailServer
hist32
iPod Service
ibmiasrw
jhi_service
mr2kserv
msftesql-Exchange
mysql
nvsvc
oracle
osppsvc
pgguard
pgsql
postgresql
sppsvc
sshd
swprv
sysdown
tvnserver
uvnc_service
vbox
vcsFPService
vmic
vmicheartbeat
vmickvpexchange
vmicrdv
vmicshutdown
vmictimesync
vmicvss
vmw
wamp
wbengine
wlidsvc" -split "\n"
$ProcessNames = 
"ABService
AGMService
AGSService
Acrobat
Adobe CEF Helper
Adobe Desktop Service
AdobeARM
AdobeCollabSync
AdobeIPCBroker
AdobeUpdateService
Agent_CORBA
AnyDesk
ApacheMonitor
AppleMobileDeviceService
ApplicationFrameHost
AsmMonitoringAgent
Atenet.Service
BASupSrvc
BASupSrvcCnfg
BASupSrvcUpdater
BTHSAmpPalService
BTHSSecurityMgr
BayanService
BigAnt
BmsAccess
BmsCommon
BmsPonAlarmTL1
BmsPonEmsTL1
BmsTest
BrCcUxSys
BrCtrlCntr
BrStMonW
BrYNSvc
BrotherHelp
BulkCollectorDm
CCC
CCXProcess
CcmExec
Citect32
CodeMeter
CodeMeterCC
ConfigurationWizard
CoreSync
Creative Cloud
CrmAsyncService
DLHM
DLMDnsSvc
DPMClient
DPMClientService
DPMClientUI
DWRCS.EXE
DWRCST.EXE
DellSystemDetect
DismHost
DriveLock
DymoPnpService
DymoQuickPrint
DynUpSvc
EEventManager
EFI
ES1000
ES1000Server
ES1000Service
EXCEL.EXE
Ec2Config
EcuRemote
EdgeTransport
Everything
Evolution
EvolutionECommService
Fiery Software
Fiery Software Manager
FileOpenBroker64
FileOpenManagerSvc64
FlashUtil64_31_0_0_122_ActiveX
FlowExport
Freedom.ServiceHost
GWX
GoogleCrashHandler
GoogleUpdate
HPDesignJetUtility
HPSIsvc
HPWMISVC
IAStorDataMgrSvc
IAStorIcon
IBM
Launchpad
LavasoftTcpService
LicSvrM
MOM
MSExchangeADTopologyService
MSExchangeMailSubmission
MSExchangeMailboxAssistants
MSExchangeThrottling
MSExchangeTransport
MSExchangeTransportLogSearch
MacriumService
MailRuUpdater
Microsoft.ActiveDirectory.WebServices
Microsoft.Crm.VssWriterService
Microsoft.Exchange.AddressBook.Service
Microsoft.Exchange.AntispamUpdateSvc
Microsoft.Exchange.EdgeSyncSvc
Microsoft.Exchange.Imap4
Microsoft.Exchange.Imap4Service
Microsoft.Exchange.Pop3
Microsoft.Exchange.Pop3Service
Microsoft.Exchange.ProtectedServiceHost
Microsoft.Exchange.RpcClientAccess.Service
Microsoft.Exchange.ServiceHost
MonAgentCore
MonAgentHost
MonAgentManager
MonitoringHost
MpCmdRun
MsDtsSrvr
MsExchangeFDS
ONENOTEM.EXE
OSPPSVC.EXE
OUTLOOK.EXE
OfficeClickToRun
OfficeHubTaskHost
PAGEANT.EXE
POWERPNT.EXE
PUTTY.EXE
PWRISOVM
PWRISOVM.EXE
PhotoshopElementsFileAgent
PmRepAgent
PrintIsolationHost
PrivacyIconClient
PrnHtml
ProLiantMonitor
QBCFMonitorService
QBDBMgrN
QBW32.EXE
RSHostingService
RSManagement
RSPortal
Receiver
ReflectMonitor
ReflectUI
ReportingServicesService
RoxioBurnLauncher
RtDCpl
RtHDVBg
RtWLan
RtkAudioService
RtlService
SMSvcHost
SNMPAgent
SPA_Net
SQLAGENT.EXE
SearchIndexer
SecurityScanMgr
SelfService
SelfServicePlugin
Service_KMS
Siemens.DesigoInsight.Service
SkyLightWorkspace
SkyLightWorkspaceConfigService
Stxhd.HostAgents
Stxhd.HostAgents.ChannelRegistrar
Stxhd.HostAgents.HAService
Stxhd.HostAgents.InputInjectionAgent
Stxhd.HostAgents.LogonAgent
Stxhd.HostAgents.LogstashAgent
Stxhd.HostAgents.PanamaCredsAgent
Stxhd.HostAgents.PegasusAgent
Stxhd.HostAgents.StxhdAgent
TNSLSNR.EXE
TdmService
TeamViewer_Service
Tomcat8Testing
Tomcat9
TortoiseProc
UNS
UltraViewer_Service
VSSVC
Veeam.Backup.CatalogDataService
Veeam.Backup.MountService
Veeam.Guest.Interaction.Proxy
VeeamDeploymentSvc
VeeamNFSSvc
VeeamTransportSvc
VisualSVNServer
WINWORD.EXE
WLIDSVC.EXE
WLIDSVCM.EXE
WaAppAgent
WinRAR
WindowsAzureGuestAgent
WindowsAzureTelemetryService
WrmServ
XperiaCompanionService
YunDetectService
account_server
acronis_license_service
acronis_notification_service
acrotray
agent
aircontrol
amazon-ssm
amazon-ssm-agent
ams_web_service
api_gateway
armsvc
arsm
asm
aspnet_state
atieclxx
atiesrxx
audiodg
bes10
bkserv
black
btwdins
capiws
catalog_manager
check_mk_agent
chrome
concentr
cpqnimgt
cpqteam
cqmghost
cqmgserv
cqmgstor
cramsrv
crserv
cygrunsrv
dbextclr11
ddm
discagt
e-faktura notifier
eEBSvc
egui
ekm
excel
exfba
fbguard
fbserver
fdhost
fdlauncher
firefox
fmplugin
ftpdaemon
fvstermiser
group_manager
hMailServer
hist32
hpsmhd
hpssaresponder
hpwmistor
hpwuschd2
httpd
iPodService
iTunesHelper
igfxEM
igfxHK
igfxTray
infasvcs
java
javacp
javaw
jhi_service
jre-8u191-windows-au
jucheck
jusched
lmgrd
mDNSResponder
mad
mmc
mqsvc
mrupdsrv
msaccess
msdtc
msexchangerepl
msftesql
msmdsrv
msserver
mysql
mysqld
mysqld-nt
net stop DymoPnpService
ngctw32
ngtray
node
ntfsvc
nusb3mon
nvvsvc
nvwmi64
ofaApp
omtsreco
oracle
pcoip_
pcoip_agent
pcoip_arbiter_win32
pcoip_vchan_printing_svc
pmserver
pmwflmgr
pmwfmntr
policy_manager
postg
python
qbupdate
redirector
rotatelogs
rundll32
sage
scheduler
shutdownmon
smhstart
snmpc32
sntlkeyssrvr
sntlsrtsrvr
spnsrvnt
spoolsv
sppsvc
sql
sqlbrowser
sqlceip
sqlservr
sqlwriter
sshd
startupcfg
store
task_manager
textagent
trcsrv
uTorrent
unsecapp
update_service
upeksvr
utorrentie
vault_manager
vcagent
vcsFPService
vee
vmtoolsd
vmware
w3wp
wfcrun32
winvnc
winword
zmqgw" -split "\n"

try {
import-module Hyper-V -ErrorAction Stop
Get-VM -ErrorAction Stop | Stop-VM
} catch { Write-Host No VM services }
Delete-Shadows

Write-Host ...Stopping nagging services:
$Services | % { Get-Service -Name $_* } | Where-Object {$_.Status -ne "Stopped"} | Stop-Service -Force -Verbose -ErrorAction SilentlyContinue
Write-Host ...killing annoying processes
$ProcessNames | % { Get-Process -ProcessName $_* } | Stop-Process -Force -Verbose -ErrorAction SilentlyContinue
Write-Host `n`tFinished!

Clear-Logs

Start-Sleep 3
}
